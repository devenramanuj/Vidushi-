<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi - Sanatan Dharma AI</title>
    <style>
        /* 1. CSS Styles */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* સ્ક્રોલ બંધ */
            background-color: #000;
            font-family: 'Arial', sans-serif;
        }

        #main-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* વિડીયો સેટિંગ્સ */
        video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
            z-index: 1;
        }

        /* Talking વિડીયો શરૂઆતમાં છુપાયેલો રહેશે */
        #talking-video {
            display: none;
            z-index: 2; /* Silent વિડીયોની ઉપર */
        }

        /* ઇનપુટ બોક્સ અને બટન (નીચેની બાજુ) */
        #input-area {
            position: absolute;
            bottom: 20px;
            z-index: 10;
            width: 90%;
            max-width: 600px;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            outline: none;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
        }

        button {
            padding: 12px 25px;
            border-radius: 25px;
            border: none;
            background-color: #ff9933; /* ભગવો રંગ */
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #e68a00;
        }

        /* લોડિંગ ઈન્ડિકેટર */
        #loading {
            display: none;
            color: white;
            position: absolute;
            bottom: 80px;
            z-index: 10;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
        }
    </style>
</head>
<body>

    <div id="main-container">
        <video id="silent-video" autoplay muted loop playsinline>
            <source src="silent.mp4" type="video/mp4">
        </video>
        
        <video id="talking-video" muted loop playsinline>
            <source src="talking.mp4" type="video/mp4">
        </video>

        <div id="loading">વિદુષી વિચારી રહી છે...</div>

        <div id="input-area">
            <input type="text" id="user-input" placeholder="અહીં પ્રશ્ન પૂછો..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">પૂછો</button>
        </div>
    </div>

    <script>
        /* 3. JavaScript Logic */

        // --- Configuration ---
        // તમારી API KEY અહીં પેસ્ટ કરો (ખાસ ધ્યાન રાખવું)
        const API_KEY = "તમારી_API_KEY_અહીં_મૂકો"; 
        
        // 1.5 Pro મોડેલ વાપર્યું છે (2.5 ઉપલબ્ધ નથી)
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${API_KEY}`;

        // Elements
        const silentVideo = document.getElementById('silent-video');
        const talkingVideo = document.getElementById('talking-video');
        const userInput = document.getElementById('user-input');
        const loadingText = document.getElementById('loading');

        // સિસ્ટમ ઇન્સ્ટ્રક્શન (બોટનું વ્યક્તિત્વ)
        const systemInstruction = `
            તારું નામ 'વિદુષી' છે. તું દેવેન્દ્રભાઈ દ્વારા બનાવવામાં આવી છે.
            તારે હંમેશા વાતની શરૂઆત "જય શ્રી કૃષ્ણ" થી કરવી (જો પહેલી વાર વાત હોય તો).
            તારે હિન્દુ સનાતન ધર્મ વિશે ઊંડું જ્ઞાન આપવાનું છે.
            તારો જવાબ ગુજરાતી ભાષામાં હોવો જોઈએ.
            તું એક ફિલોસોફર અને જ્ઞાની બોટ છે.
            જવાબ બહુ લાંબો ન આપવો, ટૂંકો અને સચોટ આપવો જેથી બોલવામાં સરળ રહે.
        `;

        let chatHistory = [
            {
                role: "user",
                parts: [{ text: systemInstruction }]
            }
        ];

        // --- વિડીયો કંટ્રોલ ફંક્શન ---
        function setTalkingState(isTalking) {
            if (isTalking) {
                silentVideo.style.display = 'none';
                talkingVideo.style.display = 'block';
                talkingVideo.play();
            } else {
                silentVideo.style.display = 'block';
                talkingVideo.style.display = 'none';
                talkingVideo.pause();
                talkingVideo.currentTime = 0; // રીસેટ
            }
        }

        // --- Text to Speech (TTS) ---
        function speakText(text) {
            // ચિન્હો હટાવવા માટેનું લોજિક (તમારી સૂચના મુજબ)
            // અલ્પવિરામ, પૂર્ણવિરામ, ઉદ્ગાર ચિહ્ન વગેરે હટાવી દેશે જેથી તે બોલે નહીં.
            const cleanText = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()?"']/g, " ");

            if ('speechSynthesis' in window) {
                // જૂનું બોલવાનું બંધ કરો
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'gu-IN'; // ગુજરાતી ભાષા
                utterance.rate = 0.9; // બોલવાની ઝડપ
                utterance.pitch = 1;

                // જ્યારે બોલવાનું શરૂ થાય
                utterance.onstart = () => {
                    setTalkingState(true);
                };

                // જ્યારે બોલવાનું પૂરું થાય
                utterance.onend = () => {
                    setTalkingState(false);
                };

                // જો કોઈ એરર આવે તો પણ વિડીયો નોર્મલ કરવો
                utterance.onerror = () => {
                    setTalkingState(false);
                };

                window.speechSynthesis.speak(utterance);
            } else {
                alert("તમારા બ્રાઉઝરમાં અવાજની સુવિધા નથી.");
            }
        }

        // --- Gemini API Call ---
        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // UI અપડેટ
            userInput.value = '';
            loadingText.style.display = 'block';

            // હિસ્ટ્રીમાં યુઝર મેસેજ ઉમેરો
            chatHistory.push({
                role: "user",
                parts: [{ text: text }]
            });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: chatHistory
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    
                    // હિસ્ટ્રીમાં બોટ મેસેજ ઉમેરો
                    chatHistory.push({
                        role: "model",
                        parts: [{ text: botResponse }]
                    });

                    loadingText.style.display = 'none';
                    
                    // જવાબ બોલો
                    speakText(botResponse);
                } else {
                    console.error("API Error:", data);
                    loadingText.innerText = "Error...";
                    setTimeout(() => loadingText.style.display = 'none', 2000);
                }

            } catch (error) {
                console.error("Network Error:", error);
                loadingText.innerText = "Network Error";
            }
        }

        // Enter કી દબાવવાથી મેસેજ મોકલો
        function handleEnter(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }

        // પેજ લોડ થાય ત્યારે ડિફોલ્ટ સ્ટેટ
        setTalkingState(false);

    </script>
</body>
</html>
