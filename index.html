<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi - Sanatan Dharma AI</title>
    <style>
        /* CSS Styles */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Arial', sans-serif;
        }

        #main-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Video Settings */
        video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
            z-index: 1;
        }

        #talking-video {
            display: none;
            z-index: 2;
        }

        /* UI Elements */
        #input-area {
            position: absolute;
            bottom: 20px;
            z-index: 10;
            width: 90%;
            max-width: 600px;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            outline: none;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
        }

        button {
            padding: 12px 25px;
            border-radius: 25px;
            border: none;
            background-color: #ff9933;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #e68a00;
        }

        #loading {
            display: none;
            color: white;
            position: absolute;
            bottom: 80px;
            z-index: 10;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <div id="main-container">
        <video id="silent-video" autoplay muted loop playsinline>
            <source src="silent.mp4" type="video/mp4">
        </video>
        
        <video id="talking-video" muted loop playsinline>
            <source src="talking.mp4" type="video/mp4">
        </video>

        <div id="loading">વિદુષી વિચારી રહી છે...</div>

        <div id="input-area">
            <input type="text" id="user-input" placeholder="અહીં પ્રશ્ન પૂછો..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">પૂછો</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const API_KEY = "તમારી_API_KEY_અહીં_મૂકો"; 
        
        // --- MODEL VERSION UPDATE ---
        // તમે માંગ્યા મુજબ અહીં 2.5 સેટ કર્યું છે.
        // જો તમને 'Flash' જોઈતું હોય તો નીચે 'gemini-2.5-pro' કાઢીને 'gemini-2.5-flash' લખી નાખવું.
        const MODEL_NAME = "gemini-2.5-pro"; 
        
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // Elements
        const silentVideo = document.getElementById('silent-video');
        const talkingVideo = document.getElementById('talking-video');
        const userInput = document.getElementById('user-input');
        const loadingText = document.getElementById('loading');

        // Bot Persona
        const systemInstruction = `
            તારું નામ 'વિદુષી' છે. તું દેવેન્દ્રભાઈ દ્વારા બનાવવામાં આવી છે.
            વાતની શરૂઆત "જય શ્રી કૃષ્ણ" થી કરવી.
            હિન્દુ સનાતન ધર્મ વિશે જ્ઞાન આપવું.
            જવાબ ગુજરાતી ભાષામાં, ટૂંકો અને મૌલિક હોવો જોઈએ.
            તમારે ઇમોશનલ અને સમજદાર રીતે વાત કરવાની છે.
        `;

        let chatHistory = [
            { role: "user", parts: [{ text: systemInstruction }] }
        ];

        // --- Video Control ---
        function setTalkingState(isTalking) {
            if (isTalking) {
                silentVideo.style.display = 'none';
                talkingVideo.style.display = 'block';
                talkingVideo.play().catch(e => console.log("Video Play Error:", e));
            } else {
                silentVideo.style.display = 'block';
                talkingVideo.style.display = 'none';
                talkingVideo.pause();
                talkingVideo.currentTime = 0;
            }
        }

        // --- TTS (Text to Speech) ---
        function speakText(text) {
            // Punctuation Removal logic (ચિન્હો બોલે નહીં તે માટે)
            const cleanText = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()?"']/g, " ");

            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // Stop previous audio

                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'gu-IN';
                utterance.rate = 1.0; 
                utterance.pitch = 1.0;

                utterance.onstart = () => setTalkingState(true);
                utterance.onend = () => setTalkingState(false);
                utterance.onerror = () => setTalkingState(false);

                window.speechSynthesis.speak(utterance);
            } else {
                alert("TTS not supported.");
            }
        }

        // --- API Call ---
        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            loadingText.style.display = 'block';

            chatHistory.push({ role: "user", parts: [{ text: text }] });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: chatHistory })
                });

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                    loadingText.style.display = 'none';
                    
                    speakText(botResponse);
                } else {
                    loadingText.innerText = "Error in response.";
                    setTimeout(() => loadingText.style.display = 'none', 2000);
                }

            } catch (error) {
                console.error("Error:", error);
                loadingText.innerText = "Error: API અથવા નેટવર્ક ચેક કરો";
                // Error આવે તો થોડી વાર પછી મેસેજ હટાવી દેવો
                setTimeout(() => loadingText.style.display = 'none', 3000);
            }
        }

        function handleEnter(event) {
            if (event.key === "Enter") sendMessage();
        }

        // Initialize
        setTalkingState(false);
    </script>
</body>
</html>
    </script>
</body>
</html>
