<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi - Voice Only AI</title>
    <style>
        /* CSS Styles */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Arial', sans-serif;
        }

        #main-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* Video Settings */
        video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
            z-index: 1;
        }

        #talking-video {
            display: none;
            z-index: 2;
        }

        /* Mic Button Styling */
        #mic-container {
            position: absolute;
            bottom: 40px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #mic-btn {
            background-color: rgba(255, 69, 0, 0.8); /* àª­àª—àªµà«‹ àªœà«‡àªµà«‹ àª•àª²àª° */
            border: 2px solid white;
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        #mic-btn:hover {
            transform: scale(1.1);
            background-color: rgba(255, 69, 0, 1);
        }

        /* àª¸àª¾àª‚àª­àª³àª¤à«€ àªµàª–àª¤à«‡ àªàª¨àª¿àª®à«‡àª¶àª¨ */
        .listening {
            animation: pulse 1.5s infinite;
            background-color: red !important;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }

        #status-text {
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }
    </style>
</head>
<body>

    <div id="main-container">
        <video id="silent-video" autoplay muted loop playsinline>
            <source src="silent.mp4" type="video/mp4">
        </video>
        
        <video id="talking-video" muted loop playsinline>
            <source src="talking.mp4" type="video/mp4">
        </video>

        <div id="mic-container">
            <div id="status-text">àª®àª¾àªˆàª• àª¦àª¬àª¾àªµà«‹ àª…àª¨à«‡ àª¬à«‹àª²à«‹</div>
            <button id="mic-btn" onclick="toggleListening()">ğŸ¤</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const API_KEY = "àª¤àª®àª¾àª°à«€_API_KEY_àª…àª¹à«€àª‚_àª®à«‚àª•à«‹";
        
        // àª¨à«‹àª‚àª§: Google API àª®àª¾àª‚ àª¹àª¾àª²àª®àª¾àª‚ àª¸à«àªŸà«‡àª¬àª² àªµàª°à«àªàª¨ 'gemini-1.5-pro' àª›à«‡. 
        // àªœà«‹ '2.5' àª¨àª¾ àªšàª¾àª²à«‡ àª¤à«‹ àª…àª¹à«€àª‚ 'gemini-1.5-pro' àªœ àª°àª¹à«‡àªµàª¾ àª¦à«‡àªœà«‹, àª¤à«‡ àª¬à«‡àª¸à«àªŸ àª°àª¿àªàª²à«àªŸ àª†àªªàª¶à«‡.
        const MODEL_NAME = "gemini-1.5-pro"; 
        
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // Elements
        const silentVideo = document.getElementById('silent-video');
        const talkingVideo = document.getElementById('talking-video');
        const micBtn = document.getElementById('mic-btn');
        const statusText = document.getElementById('status-text');

        // Speech Recognition Setup (àª—à«àªœàª°àª¾àª¤à«€ àª¸àª¾àª‚àª­àª³àªµàª¾ àª®àª¾àªŸà«‡)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'gu-IN'; // àª—à«àªœàª°àª¾àª¤à«€ àª­àª¾àª·àª¾ àª¸à«‡àªŸàª¿àª‚àª—
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                micBtn.classList.add('listening');
                statusText.innerText = "àª¸àª¾àª‚àª­àª³à«àª‚ àª›à«àª‚...";
            };

            recognition.onend = () => {
                micBtn.classList.remove('listening');
                // Status will be updated by API logic
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                statusText.innerText = "àªµàª¿àªšàª¾àª°à«àª‚ àª›à«àª‚...";
                sendMessage(transcript);
            };
        } else {
            alert("àª¤àª®àª¾àª°àª¾ àª¬à«àª°àª¾àª‰àªàª°àª®àª¾àª‚ àª®àª¾àªˆàª• àª¸àªªà«‹àª°à«àªŸ àª¨àª¥à«€. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ Chrome àª¬à«àª°àª¾àª‰àªàª° àªµàª¾àªªàª°à«‹.");
        }

        // Bot Persona
        const systemInstruction = `
            àª¤àª¾àª°à«àª‚ àª¨àª¾àª® 'àªµàª¿àª¦à«àª·à«€' àª›à«‡.
            àª¶àª°à«‚àª†àª¤ "àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£" àª¥à«€ àª•àª°àªµà«€.
            àª¹àª¿àª¨à«àª¦à« àª¸àª¨àª¾àª¤àª¨ àª§àª°à«àª® àªµàª¿àª¶à«‡ àªœà«àªàª¾àª¨ àª†àªªàªµà«àª‚.
            àªœàªµàª¾àª¬ àª®à«Œàª²àª¿àª• àª…àª¨à«‡ àªŸà«‚àª‚àª•à«‹ àª¹à«‹àªµà«‹ àªœà«‹àªˆàª àª•àª¾àª°àª£ àª•à«‡ àª¤à«‡ àª¬à«‹àª²àªµàª¾àª¨à«‹ àª›à«‡.
            àª–àª¾àª¸: àªœàªµàª¾àª¬àª®àª¾àª‚ àª•à«‹àªˆ àªªàª£ àª¸à«àªªà«‡àª¶àª¿àª¯àª² àª•à«‡àª°à«‡àª•à«àªŸàª° àª•à«‡ àªˆàª®à«‹àªœà«€ àª¨ àªµàª¾àªªàª°àªµàª¾.
        `;

        let chatHistory = [
            { role: "user", parts: [{ text: systemInstruction }] }
        ];

        // --- Video Control ---
        function setTalkingState(isTalking) {
            if (isTalking) {
                silentVideo.style.display = 'none';
                talkingVideo.style.display = 'block';
                talkingVideo.play().catch(e => console.log("Video Play Error:", e));
            } else {
                silentVideo.style.display = 'block';
                talkingVideo.style.display = 'none';
                talkingVideo.pause();
                talkingVideo.currentTime = 0;
            }
        }

        // --- Mic Button Action ---
        function toggleListening() {
            // àªœà«‹ àª…àª¤à«àª¯àª¾àª°à«‡ àª¬à«‹àªŸ àª¬à«‹àª²àª¤à«‹ àª¹à«‹àª¯, àª¤à«‹ àª¤à«‡àª¨à«‡ àªšà«‚àªª àª•àª°à«‹
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                setTalkingState(false);
                statusText.innerText = "àª®àª¾àªˆàª• àª¦àª¬àª¾àªµà«‹ àª…àª¨à«‡ àª¬à«‹àª²à«‹";
                return;
            }

            // àª°à«‡àª•à«‹àª°à«àª¡àª¿àª‚àª— àª¶àª°à«‚ àª•àª°à«‹
            if (recognition) {
                try {
                    recognition.start();
                } catch (e) {
                    console.error("Mic Error:", e);
                    recognition.stop();
                }
            }
        }

        // --- TTS (Text to Speech) ---
        function speakText(text) {
            // àªšàª¿àª¨à«àª¹à«‹ àª¹àªŸàª¾àªµàªµàª¾ (àªœà«‡àª¥à«€ àª…àª²à«àªªàªµàª¿àª°àª¾àª®, àªªà«‚àª°à«àª£àªµàª¿àª°àª¾àª® àª¨ àª¬à«‹àª²à«‡)
            const cleanText = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()?"']/g, " ");

            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'gu-IN';
                utterance.rate = 1.0; 

                utterance.onstart = () => {
                    statusText.innerText = "àª¬à«‹àª²à«€ àª°àª¹à«€ àª›à«àª‚...";
                    setTalkingState(true);
                };

                utterance.onend = () => {
                    setTalkingState(false);
                    statusText.innerText = "àª®àª¾àªˆàª• àª¦àª¬àª¾àªµà«‹ àª…àª¨à«‡ àª¬à«‹àª²à«‹";
                };

                utterance.onerror = () => {
                    setTalkingState(false);
                    statusText.innerText = "àª®àª¾àªˆàª• àª¦àª¬àª¾àªµà«‹ àª…àª¨à«‡ àª¬à«‹àª²à«‹";
                };

                window.speechSynthesis.speak(utterance);
            }
        }

        // --- API Call ---
        async function sendMessage(userText) {
            if (!userText) return;

            chatHistory.push({ role: "user", parts: [{ text: userText }] });

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: chatHistory })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                    speakText(botResponse);
                } else {
                    statusText.innerText = "Error: àª«àª°à«€ àªªà«àª°àª¯àª¤à«àª¨ àª•àª°à«‹";
                }

            } catch (error) {
                console.error("API Error:", error);
                statusText.innerText = "Netwrok Error";
            }
        }

        // Initialize
        setTalkingState(false);
    </script>
</body>
</html>
